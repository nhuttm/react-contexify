{"version":3,"file":"react-contexify.cjs.development.js","sources":["../src/components/utils.ts","../src/components/Portal.tsx","../src/components/RefTrackerProvider.tsx","../src/core/eventManager.ts","../src/hooks/usePrevious.ts","../src/hooks/useRefTracker.ts","../src/core/contextMenu.ts","../src/hooks/useContextMenu.ts","../src/components/menuController.ts","../src/constants.ts","../src/components/Menu.tsx","../src/components/Item.tsx","../src/components/Separator.tsx","../src/components/Submenu.tsx"],"sourcesContent":["import { Children, cloneElement, ReactNode, ReactElement } from 'react';\nimport ExecutionEnvironment from 'exenv';\n\nimport {\n  BooleanPredicate,\n  PredicateParams,\n  MenuAnimation,\n  TriggerEvent,\n} from '../types';\n\nexport function isFn(v: any): v is Function {\n  return typeof v === 'function';\n}\n\nexport function isStr(v: any): v is String {\n  return typeof v === 'string';\n}\n\nexport function isTouchEvent(e: TriggerEvent): e is TouchEvent {\n  return e.type === 'touchend';\n}\n\nexport function cloneItems(\n  children: ReactNode,\n  props: { triggerEvent: TriggerEvent; propsFromTrigger?: object }\n) {\n  return Children.map(\n    // remove null item\n    Children.toArray(children).filter(Boolean),\n    item => cloneElement(item as ReactElement<any>, props)\n  );\n}\n\nexport function getMousePosition(e: TriggerEvent) {\n  const pos = {\n    x: 0,\n    y: 0,\n  };\n\n  if (isTouchEvent(e) && e.changedTouches && e.changedTouches.length > 0) {\n    pos.x = e.changedTouches[0].clientX;\n    pos.y = e.changedTouches[0].clientY;\n  } else {\n    pos.x = (e as MouseEvent).clientX;\n    pos.y = (e as MouseEvent).clientY;\n  }\n\n  if (!pos.x || pos.x < 0) pos.x = 0;\n\n  if (!pos.y || pos.y < 0) pos.y = 0;\n\n  return pos;\n}\n\nexport function getPredicateValue(\n  predicate: BooleanPredicate,\n  payload: PredicateParams\n) {\n  return isFn(predicate) ? predicate(payload) : predicate;\n}\n\nexport function hasExitAnimation(animation: MenuAnimation) {\n  return !!(\n    animation &&\n    (isStr(animation) || ('exit' in animation && animation.exit))\n  );\n}\n\nexport const canUseDOM = ExecutionEnvironment.canUseDOM;\n","import React, { useEffect, useRef, useState } from 'react';\nimport { createPortal } from 'react-dom';\n\nimport { canUseDOM, isFn } from './utils';\n\nexport interface PortalProps {\n  /**\n   * HTML node where to mount the context menu.\n   *\n   * In SSR mode, prefer the callback form to be sure that document is only\n   * accessed on the client. `e.g. () => document.querySelector('#element')`\n   *\n   * `default: document.body`\n   */\n  mountNode?: Element | (() => Element);\n}\n\nexport const Portal: React.FC<PortalProps> = ({ children, mountNode }) => {\n  const [canRender, setCanRender] = useState(false);\n  const node = useRef<HTMLDivElement>();\n\n  useEffect(() => {\n    let parentNode: Element;\n    if (canUseDOM) {\n      parentNode = document.body;\n      node.current = document.createElement('div');\n\n      if (isFn(mountNode)) {\n        parentNode = mountNode();\n      } else if (mountNode instanceof Element) {\n        parentNode = mountNode;\n      }\n\n      parentNode.appendChild(node.current);\n\n      setCanRender(true);\n    }\n    return () => {\n      if (canUseDOM) {\n        parentNode.removeChild(node.current!);\n      }\n    };\n  }, [mountNode]);\n\n  if (!canUseDOM) {\n    return null;\n  }\n\n  return canRender ? createPortal(children, node.current!) : null;\n};\n","import React, { useContext, createContext } from 'react';\nimport { RefTracker } from '../hooks';\n\nconst Context = createContext({} as RefTracker);\n\n/**\n * Access parent ref tracker.\n */\nexport function useRefTrackerContext() {\n  return useContext(Context);\n}\n\nexport interface RefTrackerProviderProps {\n  refTracker: RefTracker;\n}\n\nexport const RefTrackerProvider: React.FC<RefTrackerProviderProps> = props => {\n  return (\n    <Context.Provider value={props.refTracker}>\n      {props.children}\n    </Context.Provider>\n  );\n};\n","import { EVENT } from '../constants';\n\nexport type EventType = string | number | symbol;\nexport type Handler<T = any> = (args: T) => void;\n\nexport interface EventManager<E = EventType> {\n  on<T = any>(event: E, handler: Handler<T>): EventManager<E>;\n  off<T = any>(event: E, handler?: Handler<T>): EventManager<E>;\n  emit<T = any>(event: E, args?: T): EventManager<E>;\n}\n\nfunction createEventManager<E = EventType>(): EventManager<E> {\n  const eventList = new Map<E, Set<Handler>>();\n\n  return {\n    on<T = any>(event: E, handler: Handler<T>) {\n      //eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      eventList.has(event)\n        ? eventList.get(event)?.add(handler)\n        : eventList.set(event, new Set([handler]));\n      return this;\n    },\n    off<T = any>(event: E, handler?: Handler<T>) {\n      handler ? eventList.get(event)!.delete(handler) : eventList.delete(event);\n      return this;\n    },\n    emit<T = any>(event: E, args: T) {\n      if (process.env.NODE !== 'production') {\n        const currentEv = (event as unknown) as number;\n\n        if (!eventList.has(event) && currentEv !== EVENT.HIDE_ALL) {\n          console.error(\n            `It seems that the menu you are trying to display is not renderer or you have a menu id mismatch.`,\n            `You used the menu id: ${event}`\n          );\n        }\n      }\n      eventList.has(event) &&\n        eventList.get(event)!.forEach((handler: Handler<T>) => {\n          handler(args);\n        });\n      return this;\n    },\n  };\n}\n\nexport const eventManager = createEventManager();\n","import { useEffect, useRef } from 'react';\n\nexport function usePrevious<T>(value: T) {\n  const ref = useRef<T>();\n\n  useEffect(() => {\n    ref.current = value;\n  }, [value]);\n\n  return ref.current;\n}\n","import { useRef } from 'react';\n\nexport interface RefTrackerValue {\n  node: HTMLElement;\n  isSubmenu: boolean;\n  submenuRefTracker?: RefTracker;\n}\n\nexport type RefTracker = ReturnType<typeof useRefTracker>;\n\n/**\n * Used to store children refs\n */\nexport function useRefTracker() {\n  return useRef<Map<HTMLElement, RefTrackerValue>>(new Map()).current;\n}\n","import { eventManager } from './eventManager';\nimport { MenuId, TriggerEvent } from '../types';\nimport { SyntheticEvent } from 'react';\n\nimport { EVENT } from '../constants';\n\nexport interface ShowContextMenuParams {\n  id: MenuId;\n  event: TriggerEvent;\n  props?: any;\n  position?: {\n    x: number;\n    y: number;\n  } | null;\n}\n\nexport interface ContextMenu {\n  show: (params: ShowContextMenuParams) => void;\n  hideAll: () => void;\n}\n\nconst contextMenu: ContextMenu = {\n  show({ id, event, props, position }) {\n    if (event.preventDefault) event.preventDefault();\n\n    eventManager.emit(EVENT.HIDE_ALL).emit(id, {\n      event: (event as SyntheticEvent).nativeEvent || event,\n      props,\n      position,\n    });\n  },\n  hideAll() {\n    eventManager.emit(EVENT.HIDE_ALL);\n  },\n};\n\nexport { contextMenu };\n","import { contextMenu } from '../core';\nimport { ContextMenuParams, TriggerEvent } from '../types';\n\nexport type UseContextMenuProps = Partial<\n  Pick<ContextMenuParams, 'id' | 'props'>\n>;\n\nexport function useContextMenu(props?: UseContextMenuProps) {\n  return {\n    show(event: TriggerEvent, params?: Omit<ContextMenuParams, 'event'>) {\n      if (process.env.NODE_ENV === 'development') {\n        if (!props?.id && !params?.id)\n          console.error(\n            \"You need to provide an id when initializing the hook `useContextMenu({ id: 'your id' })` or when you display the menu `show(e, { id: 'your id' })`. The later is used to override the one defined during initialization.\"\n          );\n      }\n      contextMenu.show({\n        id: (params?.id || props?.id) as string,\n        props: params?.props || props?.props,\n        event: event,\n        position: params?.position,\n      });\n    },\n    hideAll() {\n      contextMenu.hideAll();\n    },\n  };\n}\n","import { RefTrackerValue } from '../hooks';\nimport { STYLE } from '../constants';\n\ninterface Menu<T = RefTrackerValue> {\n  items: T[];\n  isRoot: boolean;\n  focusedIndex: number;\n  parentNode: HTMLElement;\n}\n\n/**\n * Used to control keyboard navigation\n */\nexport function createMenuController() {\n  const menuList = new Map<HTMLElement, Menu>();\n  let focusedIndex: number;\n  let parentNode: HTMLElement;\n  let isAtRoot: boolean;\n  let currentItems: RefTrackerValue[];\n  let forceCloseSubmenu = false;\n\n  function init(rootMenu: RefTrackerValue[]) {\n    currentItems = rootMenu;\n    focusedIndex = -1;\n    isAtRoot = true;\n  }\n\n  function focusSelectedItem() {\n    currentItems[focusedIndex].node.focus();\n  }\n\n  function isSubmenuFocused() {\n    return focusedIndex >= 0 && currentItems[focusedIndex].isSubmenu;\n  }\n\n  function getSubmenuItems() {\n    return Array.from(currentItems[focusedIndex].submenuRefTracker!.values());\n  }\n\n  function isFocused() {\n    if (focusedIndex === -1) {\n      // focus first item\n      moveDown();\n      return false;\n    }\n\n    return true;\n  }\n\n  function moveDown() {\n    if (focusedIndex + 1 < currentItems.length) {\n      focusedIndex++;\n    } else if (focusedIndex + 1 === currentItems.length) {\n      focusedIndex = 0;\n    }\n\n    if (forceCloseSubmenu) closeSubmenu();\n\n    focusSelectedItem();\n  }\n\n  function moveUp() {\n    if (focusedIndex === -1 || focusedIndex === 0) {\n      focusedIndex = currentItems.length - 1;\n    } else if (focusedIndex - 1 < currentItems.length) {\n      focusedIndex--;\n    }\n\n    if (forceCloseSubmenu) closeSubmenu();\n\n    focusSelectedItem();\n  }\n\n  function openSubmenu() {\n    if (isFocused() && isSubmenuFocused()) {\n      const submenuItems = getSubmenuItems();\n      const currentNode = currentItems[focusedIndex].node;\n\n      menuList.set(currentNode, {\n        isRoot: isAtRoot,\n        focusedIndex,\n        parentNode: parentNode || currentNode,\n        items: currentItems,\n      });\n\n      currentNode.classList.add(STYLE.submenuOpen);\n      parentNode = currentNode;\n\n      if (submenuItems.length > 0) {\n        focusedIndex = 0;\n        currentItems = submenuItems;\n      } else {\n        forceCloseSubmenu = true;\n      }\n\n      isAtRoot = false;\n\n      focusSelectedItem();\n      return true;\n    }\n    return false;\n  }\n\n  function closeSubmenu() {\n    if (isFocused() && !isAtRoot) {\n      const {\n        isRoot,\n        items,\n        focusedIndex: parentFocusedIndex,\n        parentNode: menuParentNode,\n      } = menuList.get(parentNode)!;\n\n      parentNode.classList.remove(STYLE.submenuOpen);\n\n      currentItems = items;\n      parentNode = menuParentNode;\n\n      if (isRoot) {\n        isAtRoot = true;\n        menuList.clear();\n      }\n      if (!forceCloseSubmenu) {\n        focusedIndex = parentFocusedIndex;\n        focusSelectedItem();\n      }\n    }\n  }\n\n  return {\n    init,\n    moveDown,\n    moveUp,\n    openSubmenu,\n    closeSubmenu,\n  };\n}\n","/*\n * css classes mapping\n * */\nexport const enum STYLE {\n  menu = 'react-contexify',\n  submenu = 'react-contexify react-contexify__submenu',\n  submenuArrow = 'react-contexify__submenu-arrow',\n  submenuOpen = 'react-contexify__submenu--is-open',\n  separator = 'react-contexify__separator',\n  item = 'react-contexify__item',\n  itemDisabled = 'react-contexify__item--disabled',\n  itemContent = 'react-contexify__item__content',\n  theme = 'react-contexify__theme--',\n  animationWillEnter = 'react-contexify__will-enter--',\n  animationWillLeave = 'react-contexify__will-leave--',\n}\n\nexport const enum EVENT {\n  HIDE_ALL,\n}\n\nexport const theme = {\n  light: 'light',\n  dark: 'dark',\n};\n\nexport const animation = {\n  fade: 'fade',\n  flip: 'flip',\n  scale: 'scale',\n  slide: 'slide',\n};\n\nexport const NOOP = () => {};\n","/* global: window */\nimport React, {\n  ReactNode,\n  useEffect,\n  useReducer,\n  useRef,\n  useState,\n} from 'react';\nimport cx from 'clsx';\n\nimport { Portal, PortalProps } from './Portal';\nimport { RefTrackerProvider } from './RefTrackerProvider';\n\nimport { eventManager } from '../core/eventManager';\nimport {\n  TriggerEvent,\n  MenuId,\n  ContextMenuParams,\n  MenuAnimation,\n} from '../types';\nimport { usePrevious, useRefTracker } from '../hooks';\nimport { createMenuController } from './menuController';\nimport { NOOP, STYLE, EVENT } from '../constants';\nimport {\n  cloneItems,\n  getMousePosition,\n  hasExitAnimation,\n  isFn,\n  isStr,\n} from './utils';\n\nexport interface MenuProps\n  extends PortalProps,\n    Omit<React.HTMLAttributes<HTMLElement>, 'id'> {\n  /**\n   * Unique id to identify the menu. Use to Trigger the corresponding menu\n   */\n  id: MenuId;\n\n  /**\n   * Any valid node that can be rendered\n   */\n  children: ReactNode;\n\n  /**\n   * Theme is appended to `react-contexify__theme--${given theme}`.\n   *\n   * Built-in theme are `light` and `dark`\n   */\n  theme?: string;\n\n  /**\n   * Animation is appended to\n   * - `.react-contexify__will-enter--${given animation}`\n   * - `.react-contexify__will-leave--${given animation}`\n   *\n   * - To disable all animations you can pass `false`\n   * - To disable only the enter or the exit animation you can provide an object `{enter: false, exit: 'exitAnimation'}`\n   *\n   * - default is set to `scale`\n   *\n   * To use the built-in animation a helper in available\n   * `import { animation } from 'react-contexify`\n   *\n   * animation.fade\n   */\n  animation?: MenuAnimation;\n\n  /**\n   * Invoked after the menu is visible.\n   */\n  onShown?: () => void;\n\n  /**\n   * Invoked after the menu has been hidden.\n   */\n  onHidden?: () => void;\n}\n\ninterface MenuState {\n  x: number;\n  y: number;\n  visible: boolean;\n  triggerEvent: TriggerEvent;\n  propsFromTrigger: any;\n  willLeave: boolean;\n}\n\nfunction reducer(\n  state: MenuState,\n  payload: Partial<MenuState> | ((state: MenuState) => Partial<MenuState>)\n) {\n  return isFn(payload)\n    ? { ...state, ...payload(state) }\n    : { ...state, ...payload };\n}\n\nexport const Menu: React.FC<MenuProps> = ({\n  id,\n  theme,\n  style,\n  className,\n  children,\n  mountNode,\n  animation = 'scale',\n  onHidden = NOOP,\n  onShown = NOOP,\n  ...rest\n}) => {\n  const [state, setState] = useReducer(reducer, {\n    x: 0,\n    y: 0,\n    visible: false,\n    triggerEvent: {} as TriggerEvent,\n    propsFromTrigger: null,\n    willLeave: false,\n  });\n  const nodeRef = useRef<HTMLDivElement>(null);\n  const didMount = useRef(false);\n  const wasVisible = usePrevious(state.visible);\n  const refTracker = useRefTracker();\n  const [menuController] = useState(() => createMenuController());\n\n  // subscribe event manager\n  useEffect(() => {\n    didMount.current = true;\n    eventManager.on(id, show).on(EVENT.HIDE_ALL, hide);\n\n    return () => {\n      eventManager.off(id, show).off(EVENT.HIDE_ALL, hide);\n    };\n    // hide rely on setState(dispatch), which is guaranted to be the same across render\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [id]);\n\n  // handle show/ hide callback\n  useEffect(() => {\n    if (didMount.current && state.visible !== wasVisible) {\n      state.visible ? onShown() : onHidden();\n    }\n    // wasWisible is a ref\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [state.visible, onHidden, onShown]);\n\n  // collect menu items for keyboard navigation\n  useEffect(() => {\n    if (!state.visible) {\n      refTracker.clear();\n    } else {\n      menuController.init(Array.from(refTracker.values()));\n    }\n  }, [state.visible, menuController, refTracker]);\n\n  // compute menu position\n  useEffect(() => {\n    if (state.visible) {\n      const { innerWidth: windowWidth, innerHeight: windowHeight } = window;\n      const {\n        offsetWidth: menuWidth,\n        offsetHeight: menuHeight,\n      } = nodeRef.current!;\n      let { x, y } = state;\n\n      if (x + menuWidth > windowWidth) {\n        x -= x + menuWidth - windowWidth;\n      }\n\n      if (y + menuHeight > windowHeight) {\n        y -= y + menuHeight - windowHeight;\n      }\n\n      setState({\n        x,\n        y,\n      });\n    }\n\n    // state.visible and state{x,y} are updated together\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [state.visible]);\n\n  // subscribe dom events\n  useEffect(() => {\n    function handleKeyboard(e: KeyboardEvent) {\n      e.preventDefault();\n      switch (e.key) {\n        case 'Enter':\n          if (!menuController.openSubmenu()) hide();\n          break;\n        case 'Escape':\n          hide();\n          break;\n        case 'ArrowUp':\n          menuController.moveUp();\n          break;\n        case 'ArrowDown':\n          menuController.moveDown();\n          break;\n        case 'ArrowRight':\n          menuController.openSubmenu();\n          break;\n        case 'ArrowLeft':\n          menuController.closeSubmenu();\n          break;\n      }\n    }\n\n    if (state.visible) {\n      window.addEventListener('resize', hide);\n      window.addEventListener('contextmenu', hide);\n      window.addEventListener('click', hide);\n      window.addEventListener('scroll', hide);\n      window.addEventListener('keydown', handleKeyboard);\n\n      // This let us debug the menu in the console in dev mode\n      if (process.env.NODE_ENV !== 'development') {\n        window.addEventListener('blur', hide);\n      }\n    }\n\n    return () => {\n      window.removeEventListener('resize', hide);\n      window.removeEventListener('contextmenu', hide);\n      window.removeEventListener('click', hide);\n      window.removeEventListener('scroll', hide);\n      window.removeEventListener('keydown', handleKeyboard);\n\n      if (process.env.NODE_ENV !== 'development') {\n        window.removeEventListener('blur', hide);\n      }\n    };\n    // state.visible will let us get the right reference to `hide`\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [state.visible, menuController]);\n\n  function show({ event, props, position }: ContextMenuParams) {\n    event.stopPropagation();\n    const { x, y } = position || getMousePosition(event);\n\n    // prevent react from batching the state update\n    // if the menu is already visible we have to recompute bounding rect based on position\n    setTimeout(() => {\n      setState({\n        visible: true,\n        willLeave: false,\n        x,\n        y,\n        triggerEvent: event,\n        propsFromTrigger: props,\n      });\n    }, 0);\n  }\n\n  function hide(event?: Event) {\n    // Safari trigger a click event when you ctrl + trackpad\n    // Firefox:  trigger a click event when right click occur\n    const e = event as KeyboardEvent & MouseEvent;\n\n    if (\n      typeof e !== 'undefined' &&\n      (e.button === 2 || e.ctrlKey === true) &&\n      e.type !== 'contextmenu'\n    ) {\n      return;\n    }\n\n    hasExitAnimation(animation)\n      ? setState(state => ({ willLeave: state.visible }))\n      : setState(state => ({ visible: state.visible ? false : state.visible }));\n  }\n\n  function handleAnimationEnd() {\n    if (state.willLeave && state.visible) {\n      setState({ visible: false, willLeave: false });\n    }\n  }\n\n  function computeAnimationClasses() {\n    if (!animation) return null;\n\n    if (isStr(animation)) {\n      return cx({\n        [`${STYLE.animationWillEnter}${animation}`]:\n          animation && visible && !willLeave,\n        [`${STYLE.animationWillLeave}${animation} ${STYLE.animationWillLeave}'disabled'`]:\n          animation && visible && willLeave,\n      });\n    } else if ('enter' in animation && 'exit' in animation) {\n      return cx({\n        [`${STYLE.animationWillEnter}${animation.enter}`]:\n          animation.enter && visible && !willLeave,\n        [`${STYLE.animationWillLeave}${animation.exit} ${STYLE.animationWillLeave}'disabled'`]:\n          animation.exit && visible && willLeave,\n      });\n    }\n\n    return null;\n  }\n\n  const { visible, triggerEvent, propsFromTrigger, x, y, willLeave } = state;\n  const cssClasses = cx(\n    STYLE.menu,\n    className,\n    { [`${STYLE.theme}${theme}`]: theme },\n    computeAnimationClasses()\n  );\n\n  const menuStyle = {\n    ...style,\n    left: x,\n    top: y,\n    opacity: 1,\n  };\n\n  return (\n    <Portal mountNode={mountNode}>\n      <RefTrackerProvider refTracker={refTracker}>\n        {visible && (\n          <div\n            {...rest}\n            className={cssClasses}\n            onAnimationEnd={handleAnimationEnd}\n            style={menuStyle}\n            ref={nodeRef}\n            role=\"menu\"\n          >\n            {cloneItems(children, {\n              propsFromTrigger,\n              triggerEvent,\n            })}\n          </div>\n        )}\n      </RefTrackerProvider>\n    </Portal>\n  );\n};\n","import React, { ReactNode } from 'react';\nimport cx from 'clsx';\n\nimport {\n  ItemParams,\n  InternalProps,\n  BooleanPredicate,\n  HandlerParamsEvent,\n} from '../types';\nimport { useRefTrackerContext } from './RefTrackerProvider';\nimport { NOOP, STYLE } from '../constants';\nimport { getPredicateValue } from './utils';\n\nexport interface ItemProps\n  extends InternalProps,\n    Omit<React.HTMLAttributes<HTMLElement>, 'hidden' | 'disabled' | 'onClick'> {\n  /**\n   * Any valid node that can be rendered\n   */\n  children: ReactNode;\n\n  /**\n   * Passed to the `Item` onClick callback. Accessible via `data`\n   */\n  data?: any;\n\n  /**\n   * Disable `Item`. If a function is used, a boolean must be returned\n   *\n   * @param props The props passed when you called `show(e, {props: yourProps})`\n   * @param data The data defined on the `Item`\n   * @param triggerEvent The event that triggered the context menu\n   *\n   *\n   * ```\n   * function isItemDisabled({ triggerEvent, props, data }: PredicateParams<type of props, type of data>): boolean\n   * <Item disabled={isItemDisabled} data={data}>content</Item>\n   * ```\n   */\n  disabled?: BooleanPredicate;\n\n  /**\n   * Hide the `Item`. If a function is used, a boolean must be returned\n   *\n   * @param props The props passed when you called `show(e, {props: yourProps})`\n   * @param data The data defined on the `Item`\n   * @param triggerEvent The event that triggered the context menu\n   *\n   *\n   * ```\n   * function isItemHidden({ triggerEvent, props, data }: PredicateParams<type of props, type of data>): boolean\n   * <Item hidden={isItemHidden} data={data}>content</Item>\n   * ```\n   */\n  hidden?: BooleanPredicate;\n\n  /**\n   * Callback when the `Item` is clicked.\n   *\n   * @param event The event that occured on the Item node\n   * @param props The props passed when you called `show(e, {props: yourProps})`\n   * @param data The data defined on the `Item`\n   * @param triggerEvent The event that triggered the context menu\n   *\n   * ```\n   * function handleItemClick({ triggerEvent, event, props, data }: ItemParams<type of props, type of data>){\n   *    // retrieve the id of the Item or any other dom attribute\n   *    const id = e.currentTarget.id;\n   *\n   *    // access the props and the data\n   *    console.log(props, data);\n   *\n   *    // access the coordinate of the mouse when the menu has been displayed\n   *    const {  clientX, clientY } = triggerEvent;\n   *\n   * }\n   *\n   * <Item id=\"item-id\" onClick={handleItemClick} data={{key: 'value'}}>Something</Item>\n   * ```\n   */\n  onClick?: (args: ItemParams) => void;\n}\n\nexport const Item: React.FC<ItemProps> = ({\n  children,\n  className,\n  style,\n  triggerEvent,\n  data,\n  propsFromTrigger,\n  onClick = NOOP,\n  disabled = false,\n  hidden = false,\n  ...rest\n}) => {\n  const refTracker = useRefTrackerContext();\n  const handlerParams = {\n    data,\n    triggerEvent: triggerEvent as HandlerParamsEvent,\n    props: propsFromTrigger,\n  };\n  const isDisabled = getPredicateValue(disabled, handlerParams);\n  const isHidden = getPredicateValue(hidden, handlerParams);\n\n  function handleClick(e: React.MouseEvent<HTMLElement>) {\n    (handlerParams as ItemParams).event = e;\n    isDisabled ? e.stopPropagation() : onClick(handlerParams as ItemParams);\n  }\n\n  function trackRef(node: HTMLElement | null) {\n    if (node && !isDisabled)\n      refTracker.set(node, {\n        node,\n        isSubmenu: false,\n      });\n  }\n\n  function handleKeyDown(e: React.KeyboardEvent<HTMLElement>) {\n    if (e.key === 'Enter') {\n      (handlerParams as ItemParams).event = e;\n      onClick(handlerParams as ItemParams);\n    }\n  }\n\n  if (isHidden) return null;\n\n  const cssClasses = cx(STYLE.item, className, {\n    [`${STYLE.itemDisabled}`]: isDisabled,\n  });\n\n  return (\n    <div\n      {...rest}\n      className={cssClasses}\n      style={style}\n      onClick={handleClick}\n      onKeyDown={handleKeyDown}\n      ref={trackRef}\n      tabIndex={-1}\n      role=\"menuitem\"\n      aria-disabled={isDisabled}\n    >\n      <div className={STYLE.itemContent}>{children}</div>\n    </div>\n  );\n};\n","import React from 'react';\n\nimport { STYLE } from '../constants';\n\nexport function Separator() {\n  return <div className={STYLE.separator} />;\n}\n","import React, { ReactNode, useEffect, useRef, useState } from 'react';\nimport cx from 'clsx';\n\nimport { InternalProps, BooleanPredicate, HandlerParamsEvent } from '../types';\nimport { RefTrackerProvider, useRefTrackerContext } from './RefTrackerProvider';\nimport { useRefTracker } from '../hooks';\nimport { STYLE } from '../constants';\nimport { cloneItems, getPredicateValue } from './utils';\n\nexport interface SubMenuProps\n  extends InternalProps,\n    Omit<React.HTMLAttributes<HTMLElement>, 'hidden'> {\n  /**\n   * Any valid node that can be rendered\n   */\n  label: ReactNode;\n\n  /**\n   * Any valid node that can be rendered\n   */\n  children: ReactNode;\n\n  /**\n   * Render a custom arrow\n   */\n  arrow?: ReactNode;\n\n  /**\n   * Disable the `Submenu`. If a function is used, a boolean must be returned\n   */\n  disabled?: BooleanPredicate;\n\n  /**\n   * Hide the `Submenu` and his children. If a function is used, a boolean must be returned\n   */\n  hidden?: BooleanPredicate;\n}\n\ninterface SubMenuState {\n  left?: string | number;\n  right?: string | number;\n  top?: string | number;\n  bottom?: string | number;\n}\n\nexport const Submenu: React.FC<SubMenuProps> = ({\n  arrow = '▶',\n  children,\n  disabled = false,\n  hidden = false,\n  label,\n  className,\n  triggerEvent,\n  propsFromTrigger,\n  style,\n  ...rest\n}) => {\n  const menuRefTracker = useRefTrackerContext();\n  const refTracker = useRefTracker();\n  const nodeRef = useRef<HTMLDivElement>(null);\n  const [position, setPosition] = useState<SubMenuState>({\n    left: '100%',\n    top: 0,\n    bottom: 'initial',\n  });\n  const handlerParams = {\n    triggerEvent: triggerEvent as HandlerParamsEvent,\n    props: propsFromTrigger,\n  };\n  const isDisabled = getPredicateValue(disabled, handlerParams);\n  const isHidden = getPredicateValue(hidden, handlerParams);\n\n  useEffect(() => {\n    if (nodeRef.current) {\n      const { innerWidth, innerHeight } = window;\n      const rect = nodeRef.current.getBoundingClientRect();\n      const style: SubMenuState = {};\n\n      if (rect.right < innerWidth) {\n        style.left = '100%';\n        style.right = undefined;\n      } else {\n        style.right = '100%';\n        style.left = undefined;\n      }\n\n      if (rect.bottom > innerHeight) {\n        style.bottom = 0;\n        style.top = 'initial';\n      } else {\n        style.bottom = 'initial';\n      }\n\n      setPosition(style);\n    }\n  }, []);\n\n  function handleClick(e: React.SyntheticEvent) {\n    e.stopPropagation();\n  }\n\n  function trackRef(node: HTMLElement | null) {\n    if (node && !isDisabled)\n      menuRefTracker.set(node, {\n        node,\n        isSubmenu: true,\n        submenuRefTracker: refTracker,\n      });\n  }\n\n  if (isHidden) return null;\n\n  const cssClasses = cx(STYLE.item, className, {\n    [`${STYLE.itemDisabled}`]: isDisabled,\n  });\n\n  const submenuStyle = {\n    ...style,\n    ...position,\n  };\n\n  return (\n    <RefTrackerProvider refTracker={refTracker}>\n      <div\n        {...rest}\n        className={cssClasses}\n        ref={trackRef}\n        tabIndex={-1}\n        role=\"menuitem\"\n        aria-haspopup\n        aria-disabled={isDisabled}\n      >\n        <div className={STYLE.itemContent} onClick={handleClick}>\n          {label}\n          <span className={STYLE.submenuArrow}>{arrow}</span>\n        </div>\n        <div className={STYLE.submenu} ref={nodeRef} style={submenuStyle}>\n          {cloneItems(children, {\n            propsFromTrigger,\n            // injected by the parent\n            triggerEvent: triggerEvent!,\n          })}\n        </div>\n      </div>\n    </RefTrackerProvider>\n  );\n};\n"],"names":["isFn","v","isStr","isTouchEvent","e","type","cloneItems","children","props","Children","map","toArray","filter","Boolean","item","cloneElement","getMousePosition","pos","x","y","changedTouches","length","clientX","clientY","getPredicateValue","predicate","payload","hasExitAnimation","animation","exit","canUseDOM","ExecutionEnvironment","Portal","mountNode","useState","canRender","setCanRender","node","useRef","useEffect","parentNode","document","body","current","createElement","Element","appendChild","removeChild","createPortal","Context","createContext","useRefTrackerContext","useContext","RefTrackerProvider","React","Provider","value","refTracker","createEventManager","eventList","Map","on","event","handler","has","get","add","set","Set","off","emit","args","process","env","NODE","currentEv","console","error","forEach","eventManager","usePrevious","ref","useRefTracker","contextMenu","show","id","position","preventDefault","nativeEvent","hideAll","useContextMenu","params","createMenuController","menuList","focusedIndex","isAtRoot","currentItems","forceCloseSubmenu","init","rootMenu","focusSelectedItem","focus","isSubmenuFocused","isSubmenu","getSubmenuItems","Array","from","submenuRefTracker","values","isFocused","moveDown","closeSubmenu","moveUp","openSubmenu","submenuItems","currentNode","isRoot","items","classList","parentFocusedIndex","menuParentNode","remove","clear","theme","light","dark","fade","flip","scale","slide","NOOP","reducer","state","Menu","style","className","onHidden","onShown","rest","useReducer","visible","triggerEvent","propsFromTrigger","willLeave","setState","nodeRef","didMount","wasVisible","menuController","hide","window","windowWidth","innerWidth","windowHeight","innerHeight","menuWidth","offsetWidth","menuHeight","offsetHeight","handleKeyboard","key","addEventListener","removeEventListener","stopPropagation","setTimeout","button","ctrlKey","handleAnimationEnd","computeAnimationClasses","cx","enter","cssClasses","menuStyle","left","top","opacity","onAnimationEnd","role","Item","data","onClick","disabled","hidden","handlerParams","isDisabled","isHidden","handleClick","trackRef","handleKeyDown","onKeyDown","tabIndex","Separator","Submenu","arrow","label","menuRefTracker","bottom","setPosition","rect","getBoundingClientRect","right","undefined","submenuStyle"],"mappings":"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"}